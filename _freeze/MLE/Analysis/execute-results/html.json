{
  "hash": "e70dd100568bed5fd5bf2ead042e4388",
  "result": {
    "markdown": "---\ntitle: \"Under the hood: Maximum Likelihood Estimation (MLE)\"\ndate: 09/18/2022\nauthor: Murat Koptur\nkeywords: data science, statistics, estimation, maximum likelihood estimation\ndescription: \"Understand the working mechanism of one of the most used statistical methods.\"\nexecute:\n  freeze: auto\n  warning: false\n  error: false\nformat: \n   html:\n     df-print: paged\nlisting: true\neditor: \n  markdown: \n    wrap: 72\n---\n\n\n# Introduction\n\n![Source: $^1$](images/mle.webp){width=\"400\"}\n\nMaximum likelihood is a method for constructing an estimator for an unknown \nparameter $\\theta$, which was introduced by Fisher in 1912. Method can be applied\nin most problems and often gives a reasonable estimator for $\\theta$, and if \nsample size is big, the method will give an excellent estimator of $\\theta$. For\nthese reasons, the method is most widely used estimation method in statistics $^2$.\n\nMaximum likelihood estimation can be described as follow: suppose that we observed\n$X_1,\\cdots,X_n$ from a distribution $f(x|\\theta)$. Then we define the likelihood\nfunction (the joint probability of the observed data viewed as a function of\nparameters of the statistical model) as\n\n$$L(\\theta)=f(x_1,\\ldots,x_n|\\theta)=f(x_1|\\theta)\\cdots f(x_n|\\theta)$$\n\nSince $\\text{log}$ is a monotonic increasing function, maximizing $L(\\theta)$ is\nequivalent to maximizing $\\text{log}L(\\theta)$. Then we define the log-likelihood\nfunction as\n\n$$l(\\theta)=\\text{log}L(\\theta)=\\text{log}\\prod_{i=1}^n f(X_i|\\theta)=\\sum_{i=1}^n\\text{log}f(X_i|\\theta)$$\n\nMaximizing $l(\\theta)$ with respect to $\\theta$ will give us the MLE $^{2,3}$:\n\n$$\\hat{\\theta}=\\mathop{\\mathrm{argmax}}_{\\theta\\in\\Theta}l(\\theta)$$\n\n# Examples\n\n## Estimate the distribution parameters\n\n\n::: {.cell}\n\n:::\n\n\nAssume that we observed $15$ different $X_i$ values from Poisson distribution with\nunknown $\\lambda$ (we simulate the data, so we know the true value of parameter\n$\\lambda = 3$):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobs_pois <- rpois(15, 3)\n\nplot(obs_pois)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nhist(obs_pois)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n:::\n\n\nSince we know that data is distributed as Poisson, we can write the likelihood\nand log-likelihood functions as:\n\n$$\nL(\\lambda)=\\prod_{i=1}^{n}\\exp(-\\lambda)\\frac{1}{x_i!}\\lambda^{x_i}\n$$\n\n\n$$\nl(\\lambda)=-n\\lambda-\\sum_{i=1}^n\\ln(x_i!)+\\ln(\\lambda)\\sum_{i=1}^nx_i\n$$\n\nLet's estimate:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloglikMLEpois <- function(params, x_data) {\n  sum(dpois(x_data, lambda = params[1], log = TRUE))\n}\n\nestPois <- optim(c(lambda = 1), fn = loglikMLEpois, x_data = obs_pois, control = list(fnscale=-1), method=\"BFGS\")\n\nround(estPois$par, 4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nlambda \n2.9333 \n```\n:::\n:::\n\n\nWe estimated $\\hat{\\lambda}=$ 2.9333 which is a good estimation.\n\nPlot the log-likelihood function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlogLikValuesPois <- expand.grid(lambda=seq(0, 10, 1))\nlogLikValuesPois$LL <- apply(logLikValuesPois, 1, loglikMLEpois, x_data=obs_pois)\n\nplot(logLikValuesPois$lambda, logLikValuesPois$LL, type=\"o\")\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n## Estimate the linear regression model parameters\n\nSuppose that we observed 10 different $(x_i, y_i), \\quad i=1,\\ldots,10$ samples. \nFor this, we generate some random data (Our data generation process is \n$y = 2x-1+\\epsilon$):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- seq(1, 10, 1)\ny <- 2 * x - 1 + rnorm(10)\n\ntibble(x, y)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"x\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"y\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"1.983404\"},{\"1\":\"2\",\"2\":\"2.377543\"},{\"1\":\"3\",\"2\":\"4.268464\"},{\"1\":\"4\",\"2\":\"6.483330\"},{\"1\":\"5\",\"2\":\"7.249267\"},{\"1\":\"6\",\"2\":\"11.880104\"},{\"1\":\"7\",\"2\":\"14.370010\"},{\"1\":\"8\",\"2\":\"13.312673\"},{\"1\":\"9\",\"2\":\"16.372564\"},{\"1\":\"10\",\"2\":\"19.018317\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nPlot of our generated data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(x, y, type=\"o\")\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\nWe simulated the data, so we know the true parameter values, $\\theta=(\\theta_0, \\theta_1)=(-1, 2)$. Let's\ntry to estimate them with MLE.\n\nIf we assume that errors has the Normal distribution with mean zero and standard\ndeviation one and error variance is constant, we get\n\n$$\ny~\\sim N(\\theta_0+\\theta_1x,\\sigma^2)\n$$\n\nSo we can write the conditional distribution as:\n\n$$\nf(y|x,\\theta_0,\\theta_1,\\sigma^2)=\\frac{1}{\\sqrt{2\\pi\\sigma^2}}e^{-\\frac{1}{2}\\frac{(y-(\\theta_1x+\\theta_0))^2}{\\sigma^2}}\n$$\n\nThen we get following likelihood and log-likelihood functions:\n\n$$\nL(\\theta_0,\\theta_1,\\sigma^2)=\\frac{1}{(2\\pi\\sigma^2)^{n/2}}\\prod_{(x,y)\\in X}e^\\frac{-(y-(\\theta_1 x + \\theta_0))^2}{2\\sigma^2}\n$$\n\n$$\nl(\\theta_0,\\theta_1,\\sigma^2)=-\\frac{n}{2}\\log 2\\pi-n\\log \\sigma-\\frac{1}{\\sigma^2}\\sum_{i=1}^n(y_i-(\\theta_1x_i+\\theta_0))^2\n$$\n\nLet's define log-likelihood function in R:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloglikMLEreg <- function(params, y_data) {\n  x_data = x\n  sum(dnorm(y_data, mean = params[1] + params[2] * x_data, sd = params[3], log = TRUE))\n}\n```\n:::\n\n\nMaximize:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nestReg <- optim(c(intercept = 0, slope = 1, sigma = 1), fn = loglikMLEreg,\n                y_data = y, control = list(fnscale=-1)\n                )\n\nround(estReg$par, 4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nintercept     slope     sigma \n  -1.0947    1.9684    1.0153 \n```\n:::\n:::\n\n\nOur estimation is $\\hat{\\theta}=($-1.0946921, 1.9683684$)$. We know that true values are\n$\\theta=(-1, 2)$ so this estimation is a pretty good.\n\nLastly, visualize our log-likelihood function with constant sigma:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(reshape2)\nlibrary(plotly)\n\nlogLikValues <- expand.grid(theta_0=seq(-5, 5, 1), theta_1=seq(-5, 5, 1))\nlogLikValues$sigma <- 1\nlogLikValues$LL <- apply(logLikValues, 1, loglikMLEreg, y_data=y)\n\nplot_matrix <- t(acast(logLikValues, theta_0~theta_1, value.var=\"LL\"))\n\nplot_ly(\n      x = as.numeric(colnames(plot_matrix)), \n      y = as.numeric(rownames(plot_matrix)), \n      z = plot_matrix\n    ) %>% \n  add_surface() %>%\n    layout(\n    scene = list(\n      xaxis = list(title = \"theta_0\"),\n      yaxis = list(title = \"theta_1\"),\n      zaxis = list(title = \"LL\")\n    ))\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-798441fdaea77ad32f6b\" style=\"width:100%;height:464px;\" class=\"plotly html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-798441fdaea77ad32f6b\">{\"x\":{\"visdat\":{\"76c42423267\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"76c42423267\",\"attrs\":{\"76c42423267\":{\"x\":[-5,-4,-3,-2,-1,0,1,2,3,4,5],\"y\":[-5,-4,-3,-2,-1,0,1,2,3,4,5],\"z\":[[-10934.9322484066,-10517.6165724981,-10110.3008965896,-9712.98522068113,-9325.66954477265,-8948.35386886417,-8581.03819295569,-8223.7225170472,-7876.40684113872,-7539.09116523024,-7211.77548932175],[-8229.8003892592,-7867.48471335072,-7515.16903744224,-7172.85336153375,-6840.53768562527,-6518.22200971679,-6205.90633380831,-5903.59065789982,-5611.27498199134,-5328.95930608286,-5056.64363017438],[-5909.66853011182,-5602.35285420334,-5305.03717829486,-5017.72150238638,-4740.40582647789,-4473.09015056941,-4215.77447466093,-3968.45879875244,-3731.14312284396,-3503.82744693548,-3286.511771027],[-3974.53667096444,-3722.22099505596,-3479.90531914748,-3247.589643239,-3025.27396733051,-2812.95829142203,-2610.64261551355,-2418.32693960507,-2236.01126369658,-2063.6955877881,-1901.37991187962],[-2424.40481181707,-2227.08913590858,-2039.7734600001,-1862.45778409162,-1695.14210818313,-1537.82643227465,-1390.51075636617,-1253.19508045769,-1125.8794045492,-1008.56372864072,-901.248052732237],[-1259.27295266969,-1116.9572767612,-984.641600852721,-862.325924944238,-750.010249035755,-647.694573127272,-555.378897218789,-473.063221310307,-400.747545401824,-338.431869493341,-286.116193584858],[-479.141093522307,-391.825417613824,-314.509741705341,-247.194065796859,-189.878389888376,-142.562713979893,-105.24703807141,-77.9313621629273,-60.6156862544445,-53.3000103459616,-55.9843344374788],[-84.0092343749279,-51.6935584664451,-29.3778825579623,-17.0622066494794,-14.7465307409966,-22.4308548325137,-40.1151789240309,-67.7995030155481,-105.483827107065,-153.168151198582,-210.8524752901],[-73.8773752275487,-96.5616993190659,-129.246023410583,-171.9303475021,-224.614671593617,-287.298995685135,-359.983319776652,-442.667643868169,-535.351967959686,-638.036292051203,-750.72061614272],[-448.745516080169,-526.429840171687,-614.114164263204,-711.798488354721,-819.482812446238,-937.167136537755,-1064.85146062927,-1202.53578472079,-1350.22010881231,-1507.90443290382,-1675.58875699534],[-1208.61365693279,-1341.29798102431,-1483.98230511582,-1636.66662920734,-1799.35095329886,-1972.03527739038,-2154.71960148189,-2347.40392557341,-2550.08824966493,-2762.77257375644,-2985.45689784796]],\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"surface\",\"inherit\":true}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"scene\":{\"xaxis\":{\"title\":\"theta_0\"},\"yaxis\":{\"title\":\"theta_1\"},\"zaxis\":{\"title\":\"LL\"}},\"hovermode\":\"closest\",\"showlegend\":false,\"legend\":{\"yanchor\":\"top\",\"y\":0.5}},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"colorbar\":{\"title\":\"\",\"ticklen\":2,\"len\":0.5,\"lenmode\":\"fraction\",\"y\":1,\"yanchor\":\"top\"},\"colorscale\":[[\"0\",\"rgba(68,1,84,1)\"],[\"0.0416666666666667\",\"rgba(70,19,97,1)\"],[\"0.0833333333333333\",\"rgba(72,32,111,1)\"],[\"0.125\",\"rgba(71,45,122,1)\"],[\"0.166666666666667\",\"rgba(68,58,128,1)\"],[\"0.208333333333333\",\"rgba(64,70,135,1)\"],[\"0.25\",\"rgba(60,82,138,1)\"],[\"0.291666666666667\",\"rgba(56,93,140,1)\"],[\"0.333333333333333\",\"rgba(49,104,142,1)\"],[\"0.375\",\"rgba(46,114,142,1)\"],[\"0.416666666666667\",\"rgba(42,123,142,1)\"],[\"0.458333333333333\",\"rgba(38,133,141,1)\"],[\"0.5\",\"rgba(37,144,140,1)\"],[\"0.541666666666667\",\"rgba(33,154,138,1)\"],[\"0.583333333333333\",\"rgba(39,164,133,1)\"],[\"0.625\",\"rgba(47,174,127,1)\"],[\"0.666666666666667\",\"rgba(53,183,121,1)\"],[\"0.708333333333333\",\"rgba(79,191,110,1)\"],[\"0.75\",\"rgba(98,199,98,1)\"],[\"0.791666666666667\",\"rgba(119,207,85,1)\"],[\"0.833333333333333\",\"rgba(147,214,70,1)\"],[\"0.875\",\"rgba(172,220,52,1)\"],[\"0.916666666666667\",\"rgba(199,225,42,1)\"],[\"0.958333333333333\",\"rgba(226,228,40,1)\"],[\"1\",\"rgba(253,231,37,1)\"]],\"showscale\":true,\"x\":[-5,-4,-3,-2,-1,0,1,2,3,4,5],\"y\":[-5,-4,-3,-2,-1,0,1,2,3,4,5],\"z\":[[-10934.9322484066,-10517.6165724981,-10110.3008965896,-9712.98522068113,-9325.66954477265,-8948.35386886417,-8581.03819295569,-8223.7225170472,-7876.40684113872,-7539.09116523024,-7211.77548932175],[-8229.8003892592,-7867.48471335072,-7515.16903744224,-7172.85336153375,-6840.53768562527,-6518.22200971679,-6205.90633380831,-5903.59065789982,-5611.27498199134,-5328.95930608286,-5056.64363017438],[-5909.66853011182,-5602.35285420334,-5305.03717829486,-5017.72150238638,-4740.40582647789,-4473.09015056941,-4215.77447466093,-3968.45879875244,-3731.14312284396,-3503.82744693548,-3286.511771027],[-3974.53667096444,-3722.22099505596,-3479.90531914748,-3247.589643239,-3025.27396733051,-2812.95829142203,-2610.64261551355,-2418.32693960507,-2236.01126369658,-2063.6955877881,-1901.37991187962],[-2424.40481181707,-2227.08913590858,-2039.7734600001,-1862.45778409162,-1695.14210818313,-1537.82643227465,-1390.51075636617,-1253.19508045769,-1125.8794045492,-1008.56372864072,-901.248052732237],[-1259.27295266969,-1116.9572767612,-984.641600852721,-862.325924944238,-750.010249035755,-647.694573127272,-555.378897218789,-473.063221310307,-400.747545401824,-338.431869493341,-286.116193584858],[-479.141093522307,-391.825417613824,-314.509741705341,-247.194065796859,-189.878389888376,-142.562713979893,-105.24703807141,-77.9313621629273,-60.6156862544445,-53.3000103459616,-55.9843344374788],[-84.0092343749279,-51.6935584664451,-29.3778825579623,-17.0622066494794,-14.7465307409966,-22.4308548325137,-40.1151789240309,-67.7995030155481,-105.483827107065,-153.168151198582,-210.8524752901],[-73.8773752275487,-96.5616993190659,-129.246023410583,-171.9303475021,-224.614671593617,-287.298995685135,-359.983319776652,-442.667643868169,-535.351967959686,-638.036292051203,-750.72061614272],[-448.745516080169,-526.429840171687,-614.114164263204,-711.798488354721,-819.482812446238,-937.167136537755,-1064.85146062927,-1202.53578472079,-1350.22010881231,-1507.90443290382,-1675.58875699534],[-1208.61365693279,-1341.29798102431,-1483.98230511582,-1636.66662920734,-1799.35095329886,-1972.03527739038,-2154.71960148189,-2347.40392557341,-2550.08824966493,-2762.77257375644,-2985.45689784796]],\"type\":\"surface\",\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nFull source code:\n<https://github.com/mrtkp9993/MyDsProjects/tree/main/MLE>\n\n# References\n\n$^1$ <https://media.geeksforgeeks.org/wp-content/uploads/20210415012617/MLEexample.png>\n\n$^2$ <https://people.missouristate.edu/songfengzheng/Teaching/MTH541/Lecture%20notes/MLE.pdf>\n\n$^3$ <https://en.wikipedia.org/wiki/Likelihood_function?oldformat=true>\n\n\n",
    "supporting": [
      "Analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\r\n<script src=\"../site_libs/plotly-binding-4.10.0/plotly.js\"></script>\r\n<script src=\"../site_libs/typedarray-0.1/typedarray.min.js\"></script>\r\n<script src=\"../site_libs/jquery-3.5.1/jquery.min.js\"></script>\r\n<link href=\"../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\r\n<link href=\"../site_libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\r\n<script src=\"../site_libs/plotly-main-2.5.1/plotly-latest.min.js\"></script>\r\n<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}