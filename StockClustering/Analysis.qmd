---
title: "Stock Return and Fundamental Clustering & Portfolio Selection"
date: 08/26/2022
author: Murat Koptur
execute:
  freeze: auto
  echo: false
  warning: false
  error: false
format: 
   html:
     df-print: paged
listing: true
---

We have following features for BIST30 stocks:

-   Momentum 3-months, 6-months, 1-year

-   Volatility 1-year, 2-year, 3-year

-   Price-To-Book Ratio

-   Market Capitalization

-   Return On Equity

-   Earnings Growth

```{r}
library(readr)
data <- read_csv("data.csv")
data
```

We need to standardize the features:

```{r}
#| echo: fenced
library(scales)

cols <- 5:ncol(data)

data_scaled <- lapply(data[, cols], function(x) if(is.numeric(x)) rescale(x, to=c(0,1)) else x)
data_scaled <- as.data.frame(data_scaled)
data_scaled <- cbind(data[,1:4], data_scaled)
data_scaled
```

We will use K-means method. Let's plot elbow plot:

![](images/paste-1622CD6D.png){width="400"}

We have four clusters, let's fit model and see results:

| Clusters | N    | R$^{2}$ | AIC       | BIC       | Silhouette |
|----------|------|---------|-----------|-----------|------------|
| $4$      | $30$ | $0.606$ | $194.190$ | $250.240$ | $0.310$    |

| Cluster                                           | $1$      | $2$      | $3$      | $4$     |
|-------------------------------|----------|----------|----------|----------|
| Size                                              | $17$     | $2$      | $9$      | $2$     |
| Explained proportion within-cluster heterogeneity | $0.616$  | $0.127$  | $0.192$  | $0.065$ |
| Within sum of squares                             | $70.320$ | $14.532$ | $21.962$ | $7.376$ |
| Silhouette score                                  | $0.267$  | $0.029$  | $0.419$  | $0.449$ |

|                         | Value    |
|-------------------------|----------|
| Maximum diameter        | $5.696$  |
| Minimum separation      | $1.664$  |
| Pearson's Î³             | $0.593$  |
| Dunn index              | $0.292$  |
| Entropy                 | $1.044$  |
| Calinski-Harabasz index | $13.343$ |

There is no negative silhouette score, but second cluster's score is near to zero. It indicates that seperetion is not well.

Cluster contents:

```{r}
library(dplyr)

data_clustered <- read_csv("data_clustered.csv")

data_clustered[,c(1,15)]
```

Let's look the mean return statistics of each cluster:

```{r}
data_clustered %>%
  group_by(predicted_cluster) %>%
  summarise(
    mean_1_year_return = mean(return1y),
    std_1_year_return = sd(return1y),
    mean_2_year_return = mean(return2y),
    std_2_year_return = sd(return2y),
    mean_3_year_return = mean(return3y),
    std_3_year_return = sd(return3y),
    )
```

Mean returns will be better if we select stocks from a bigger stock set like BIST100 or all BIST stocks.

Full source code: <https://github.com/mrtkp9993/MyDsProjects/tree/main/StockClustering>

## References

-   <https://www.investopedia.com/terms/c/cluster_analysis.asp>

-   <https://www.investopedia.com/terms/f/factor-investing.asp>
